
## 新要素詳細



### 排泄要素

- 世界設定のオプションから排泄要素を設定できる、デフォルトはオン
- サイドバーのステータス表示に排泄欲の項目を追加
  - 「ラベル」のサイドバーは、「欲求」の空きスペースにも排泄欲を組み込んであります。
  - 自己認識能力の特質を持っていると「排泄欲」がパーセント表示で分かるようになる。自己認識能力ってスゴイ。
- プレイヤーが食べたものが実際の貯蓄カロリーに足されるタイミングで、食べたものの容量と水分に応じて「排泄量」が増加する
- 「排泄量」が一定を超えると「排泄量」に応じて「排泄欲」が上昇し始める
  - 睡眠中は「排泄欲」の増加量が半減
- 「排泄欲」が一定を超えると排泄行動ができるようになる
- 排泄行動のデフォルトは「0」(ゼロ)キー、キーコンフィグで変更可能
- 排泄行動はいつでも可能で、3分間かかる
- 排泄行動が完了すると、「排泄量」「排泄欲」をゼロにして、「排泄量」に応じた量の排泄物を足元に落とし、多少の意欲がアップする
  - 家屋などのトイレや、クラフトで作れる車載トイレの地形上で排泄すると、さらに意欲にボーナス
  - 排泄完了時に、所持品の中の「紙製かつ、容積が0.1L～0.5Lかつ、不潔でない」アイテムをトイレットペーパーとして\*使用\*できる
    - トイレットペーパーを\*使用\*すると意欲が上昇する
    - 使わなくても特にペナルティはない
    - \*使用\*したアイテムは不潔になり、足元に落とす
    - アイテムのjsonに\*使用\*時の意欲とメッセージを指定できる
      - デフォルトではサンプルとして、札束や本物のトイレットペーパー等に指定してます
  - ウォシュレット付きトイレの上で排泄した場合、ウォシュレットを使える
    - 車の水1L、バッテリー500、1分で意欲が上がる
- 排泄しないまま「排泄欲」が上限を超えると漏らす
  - 漏らすと、即時・強制的に排泄すると同時に脚装備をすべて不潔にして、意欲がダウンする
    - 漏らしても、脚装備を1つも付けていなかった場合は、逆に意欲がアップする
- 排泄物はアイテムとしてバニラに存在する犬のフンとほぼ同等
- 車載トイレはeで調べることで水3Lを消費して流せる
- デバッグのプレイヤーの欲求編集で、「排泄量」「排泄欲」を確認・操作できるように

### リトルメイド拡張

- 同梱ModのLittlemaidをオンにすることで、同じく同梱のBattle_MaidのModに含まれる友好Mobの機能を拡張する
  - Battle Maidの原作者様に感謝と謝罪をしながら遊んでくださいね。
- 愛玩用リトルメイド(搾乳可能)からクラフトで、愛玩用リトルメイド(解放)を作って使用することで、愛玩用リトルメイドを友好Mobとして召喚できる
- 友好Mobのメイドさん(ショゴス)か、愛玩用メイドをeで調べることでペットメニューが開く
- メイド共通で、勝手に歩かない待機命令、コスチューム変更の命令ができる
- リトルメイドはそれに加えて、アイテム状態に戻す片付けと、喋らない命令ができる
- コスチュームを通常に戻すとき、1/10の確率で原作同梱タイルのコスチュームになる
- メイドと4種類の「Lovely Activity」（以下「遊び」）が行える
  - 遊びの種類は、「Kiss」「Petting」「Get Service」「\*Special\*」（英語版）
  - どの遊びでも10分かかり、主人の意欲が上昇する
  - 遊びの種類によってで主人とメイドの「Happiness」「Comfortness」の上昇値が異なる
  - メイドの「Comfortness」が最大になると40前後のMaid Pointが手に入り、メイドの「Fatigue」値が上昇する、「Fatigue」値は時間経過で減少する
    - 1回の遊びでメイドと主人の「Comfortness」が同時に最大になると、より多くのMaid Pointが手に入る
      - さらにショゴスメイドは1/5の確率でショゴスの卵を産む。ショゴスの卵は粉末卵に加工して食用にできる
  - 主人の「Comfortness」が最大になると大幅に意欲が上昇し、主人の疲労値（≒眠気）が上昇する
  - 「Comfortness」は「Heppiness」が高いほど上がりやすく、「Fatigue」が高いと上がりにくい
  - メイドの「Happiness」等の値は遊びが終わった後のメッセージによって大まかなヒントを得られる
  - 主人の「Confortness」等の値は＠のステータス画面で確認できる
- メイドはBattleMaidの元々のセリフに加えて、状況に応じた追加セリフをしゃべる
  -  主人との遊びの状況に応じて
  -  主人の就寝時と起床時
  - 自身のコスチューム状態について
  - 主人が脚防具を付けていない時
  - リトルメイド自身が敵に攻撃されている時
  - 特定のモンスターが視界内にいるとき
- メイドは主人が視界に入っていない時は喋らない
  - クラフト等の作業を妨害しないため。
    - 「北から"テケリ・リ！"が聞こえました！作業を中断しますか？(y/n)」
  - 判断基準はメイドから見えているかどうかなので、暗視力の差や視線トリックによって主人から見えない場所で喋って作業を邪魔する可能性も
- 主人が寝ているのを見るとショゴスメイドもリトルメイドも喋ったり動いたりしなくなる

### 車載シャワー

 - 車載シャワーブースを作って車に搭載し、eで調べることでシャワーを浴びられる
 -  シャワーを浴びるには、30Lの飲料水(水ではダメ)と2000のバッテリー(自動車バッテリー1個弱)のリソースを車のタンクから使う
 - シャワーを浴びるには、濡れると意欲が下がる衣服を全て脱ぐ必要がある
   - つまり[WATER_FRIENDLY]フラグがない衣類。
 - シャワーを浴びるには10分かかる
 - シャワーを浴びると意欲がアップし、全身ずぶ濡れになる
 - シャワーを浴びると、24時間の間、体臭が少し軽減される効果が付きます。
 - 電力5000消費で温かいシャワーを浴びることもできる
   - 温かいシャワーは意欲のボーナスが大きく、使用中に暖気を放出する
   - 夏場に浴びると気温上昇による火傷のおそれがあるので注意
 - 水5Lとバッテリー200で手洗いだけをすることもできる
   - 小さく意欲が上がるだけだけど、トイレの後は手を洗う潔癖ロールプレイに。

### 衣類の香り

- 車載洗濯機で衣類や防具を洗濯するといい香りフラグが付く
  - このために、洗濯機が不潔でないアイテムを拒否しないように変更
- いい香りフラグは、着ている部位が水などで濡れるか、衣服が攻撃を受けた（損傷しなくても）時に消失する
  - 時間経過では消失しない
- いい香りの衣服を着ていると、意欲が上昇する
  - ちょうど不潔な衣服の反対のような感じ。

### 天候調整・酸性雨

 - 世界設定オプションから、ヴァリアント版の気候に設定できる
   - ヴァリアント版の気候は、全体的に雨がかなり多く降る
     - [通常の気候（ゲーム開始直後）](https://github.com/roloa/Cataclysm-DDA_variant/blob/variant_jp/doc/weather_vanilla.png)
     - [ヴァリアント版の気候（ゲーム開始直後）](https://github.com/roloa/Cataclysm-DDA_variant/blob/variant_jp/doc/weather_variant.png)
   - ヴァリアント版気候の細かい特徴
     - 晴れや曇りと、雨の間に、必ず小雨が挟まり、晴れからいきなり雨が降ったり止んだりがなくなる
     - 霧雨は曇りと小雨の間ではなく、雨とは関係なく独立して発生するようになる
     - 霧雨と晴れの境目に虹が出ることがある
       - 虹が出ている時に野外にいると意欲UP
       - 冬季は虹の代わりに細氷 [ Diamond Dust ] になる
     - 雷雨と豪雨の悪天候が重なると、逆に台風の目のように、快晴になる
- 世界設定オプションから、酸性雨の量を調整できる
  - 基本的には最大の100を想定して調整しているが、デフォルトでは少なめの20にしてある
- バニラからの既存の仕様で、天気には雨の強度と独立して酸の強度が設定されていて、雨が降っている、かつ、酸強度が一定以上だと酸性雨になる
  - バニラでは酸強度が常に0なので酸性雨は降らない
- （バランス調整中）野外にいるすべてのモンスターも酸性雨で少量のダメージを受ける
  - NPCは（たぶん）ダメージを受けない
- 酸性嵐を追加
  -  強い酸強度と雷雨以上の強い雨が重なると、より強力な酸性嵐 [ Acid Storm ] になる
  - 強い酸強度と吹雪が重なっても、酸性嵐になる
- 酸性雪と小酸性雪を追加
  - 気温が摂氏0度以下だと酸性雨の代わりに酸性雪や小酸性雪が降る 
- 小酸性雨、小酸性雪は苦痛 \* (15) までの苦痛を受ける
  - パワーアーマーヘルメット、傘を構える、レインコート等の雨を防ぐ衣服で完全に防げる
- 酸性雨、酸性雪は苦痛\*\*\*\* (45) までの苦痛と、約300ターン毎に全身のHPが1減少する
  - パワーアーマーヘルメット、傘を構えることで完全に防げる
  - レインコート等の雨を防ぐ衣服で90%防げる
  - モンスターは、約600ターンごとにHPが1減少する
- 酸性嵐は、苦痛\*\*\*\*\*\*\* 以上(105) までの苦痛と、約30ターン毎に全身のHPが1減少する
  - パワーアーマーヘルメットで完全に防げる
  - 傘を構えることで90%防げる
  - レインコート等の雨を防ぐ衣服で75%防げる
    - 傘とレインコートを両方使えば掛け算式に97.5%防げる
  - モンスターは、約600ターンごとにHPが9減少する
- 嵐を呼び寄せる効果のアーティファクトは天候を酸性嵐にするように（バニラでは吹雪）

### FTL: Fast TLavel (車両ワープ、ファストトラベル機能)

*最新かつ複雑な機能につき、バグ出しが完璧でない可能性があります。ご注意ください。*

- 車両にFTLエンジンを搭載することで、原子力電池1個と引き換えに、車両と乗員ごとFTLビーコンへワープ移動できる
- FTLエンジンのレシピ習得条件は、機械整備8、電子工学6、製作4が必要
  - FTLエンジンの主な材料は、瞬間移動装置 3個, 小型反応炉 1個
- FTLビーコンは、同梱の「FTLビーコン生成」modを導入することで道端に自然生成されるほか、FTLビーコン設置ツールを製作して使用することで、好きな場所をFTLビーコンにできる
  - FTLビーコン設置ツールは、電子工学6、機械整備4で習得、主な材料として、原子力電池 3個と、無線中継モジュール 1個が必要
  - FTLビーコン設置ツールであらゆる地点をFTLビーコンに設定できるが、下記の車両の破壊を起こさないように細心の注意を払ってください
- FTLドライブによるワープ先に通行不可能な障害物が存在すると、車両がトリフィドに襲われた時のように破壊されます。
  - 自然生成のFTLビーコンは、それが起こらないよう周囲を平地に設定しています。FTLビーコンの周囲のスペースは十分に取ってください。
- 自然生成のFTLビーコンにて、稀にビーコンマップが手に入る。ビーコンマップを使うと、広範囲のビーコンの場所が地図上で明らかになる
- z軸を移動するFTLドライブも可能。ワープ先が崖っぷちの際の転落には十分注意してください


#### FTLドライブの手順

1. FTLエンジンを搭載した車両に乗り、燃料の原子力電池1個を所持品に持ち、ワープ先のFTLビーコンを確保しておく。
2. 車両の制御装置と同じマスに移動し。[e]で足元の制御装置を調べる。車両メニューから「FTLドライブ」を選択する
  - エンジン始動等の項目がある車両制御メニューではない事に注意してください。車両制御[^]ではありません。
3. FTLチャージが始まったら、*その場所を動かずに*1時間待機する。
4. FTLチャージが完了したら、*その場所を動かずに*[e]で足元の制御装置を調べ、車両メニューから「FTLドライブ」を選択する
5. マップが開くので、マップ上のワープ先のFTLビーコンにカーソルを合わせ、エンターキーで決定する。
6. 問題が無ければ、ワープが完了します。


#### FTLドライブのこだわりポイント

- FTLチャージを継続するための条件は、「いずれか1つの制御装置上に、プレイヤーまたはNPCがいること」です。
  - 運転席にNPCを座らせておけば、プレイヤーの位置に関係なくチャージが進みます。
  - 車両のすべてのマスに制御装置を取り付ければ、チャージ中に自由に移動できます。
- FTLチャージが完了したときと、FTLドライブを実行したときの効果音を指定できます。
  - このファストトラベル機能のデザインのリスペクト先のゲームの、同効果音が入手できれば、実際に設定してみても、いい感じです。
  - サウンド指定は、[data/sound/Basic/ftl_soundset.json](https://github.com/roloa/Cataclysm-DDA_variant/blob/variant_jp/data/sound/Basic/ftl_soundset.json)にサンプルがあります。

### カスタムアクティビティ

- クラフトや建築のような継続行動を、単純な機能のみになりますが、jsonで記述できる
- 今のところは、ペットにしたモンスターを[e]で調べたときに追加するもののみ
- カスタマイズできる項目は以下のようなものがあります
  - 対象モンスター
  - 開始や完了時などの各種メッセージ
  - 完了までの時間
  - 意欲のメッセージと上昇値、継続時間など
  - プレイヤーが受ける効果と、その継続時間など
  - 獲得アイテム
  - クールダウン時間
- 英語ですが、猫を毛づくろいするサンプルを/data/mods/Variant_Addition/custom_activity/sampleに用意しました
  - 10分かけて毛づくろいし、その後3分間、猫の毛だらけになって器用と感覚が少し下がります。猫の毛が22個、足元に落ちます。10分ごとに実行できる
  - https://github.com/roloa/Cataclysm-DDA_variant/blob/variant_jp/data/mods/Variant_Addition/custom_activity/sample/custom_activity_sample.json
- リリースに同梱のVariant_Junkyardにも、別の日本語のサンプルがあります

### 近接発動エンチャント

**現在バランス未調整につき、デフォルトではオフにしてある機能です。**

皆さまからのバランス調整のご意見が集まり次第、本格的に詳細の開発・有効化をしていく予定です。

- 近接武器に、特殊効果発動のエンチャントが付くことがあります。
  - エンチャントの付加率は、オプションから設定できます。（現在はデフォルトでゼロ）
  - エンチャントの発動効果、発動確率や出現率は、jsonの変更や、modのjsonによって設定できます。
  - エンチャントはすべて、近接武器の近接攻撃が命中した時に発動するものです。
  - エンチャントの種類は、以下のようなものがあります。
    - 攻撃命中時に、攻撃対象に状態異常を付加
    - 攻撃命中時に、武器の持ち主に状態異常を付加（もちろんプラス効果ですよ！）
    - 攻撃命中時に、攻撃対象のいる場所に、煙や炎などの地形特殊効果を生成
    - 攻撃命中時に、武器の持ち主のHPやスタミナ、マナ等を固定値で回復
    - 攻撃命中時に、周囲の敵に内部的に設定した銃を発射する
  - エンチャントが付く可能性があるのは、斬撃、打撃、刺突のいずれかの攻撃力が8を超えているアイテムの想定です。
    - まだ条件判定が適当なため、そうなっていない可能性があります...

  - エンチャントに関係する以下のようなアイテムがあります。
    - 指定したアイテムに、内部的に指定されたエンチャントを付加する「エンチャンターアイテム」
    - 指定したアイテムのエンチャントを全て消去する「エンチャントクリーナー」

### [Mod] ビタミンによる能力アップ（とダウン）

- ビタミン（＝栄養素）の欠乏症や過剰症によって、主能力が-1～+2の範囲で変動するModが同梱されています。
  - ビタミンの過剰症の最大段階で、ステータスが+2（速度は+10）されますが、ビタミンを摂り続けないと長続きしません。
  - ビタミンの過剰症の第2段階で、ステータスが+1（速度は+5）されます。
  - ビタミンの欠乏症の第2段階で、鉄分による速度のみ、-2されます。
  - ビタミンの欠乏症の最大段階で、ステータスが-1（速度は-5）されます。

- ビタミンとステータスの対応関係は以下です。
  - 鉄分：速度
  - カルシウム：筋肉
  - ビタミンB：器用
  - ビタミンC：知力
  - ビタミンA：感覚

### NPC拡張：車載カーゴからの自動食事

**不安定な試験的機能です！特に以下の状況によって、予想できない不具合が起こることが予想されます(?)ので、ご注意ください**

- 2人以上のNPCが同じ食糧庫から同時に食事をしようとする
- NPCとプレイヤーが同じ食糧庫のアイテムを同時に操作しようとする

- 味方NPCと一緒に車に乗っている時、条件に応じて味方NPCが車載カーゴから勝手に食料を食べる
- 車載パーツの「食糧庫タグ」を作って車載カーゴと同じマスに付けると、NPCは食糧庫として認識する
  - 食糧庫タグはUPS充電ステーションと同様の扱いで、充電ステーションと同じマスには付けられない
- NPCはお腹が空くか喉が渇くと、食糧庫の隣まで歩いて行って、食糧庫から欲しい飲食物を直接食べる
  - 後述の不具合回避のため食糧庫にプレイヤーが隣接している時は手を出さない
  - 食糧庫内のアイテムにプレイヤーとNPCや、2人のNPCが同時に手を出すと予測不可能なまずいことになりそうなので、今のところは注意して使ってください。

### 車両処理省略による負荷の軽減

- 車両の処理を減らすことでクラフトや睡眠のターン処理を軽量化する機能を追加。
- 制御装置のあるマスをeで調べることで車両ごとに有効化できます
  - 積荷処理省略は、毎ターン行われる積荷内のアイテムチェックを1分に一度にする
    - おそらく、ピンの抜かれた手榴弾や電源の入った懐中電灯などのカウントを減らす処理が省略される。
    - アイテムを大量に積んでる場合は少し動作が速くなるかも
  - 自動タレット処理省略は、車載された自動照準のタレットの索敵と射撃の処理を1分に一度だけにする
    - 自動タレットの処理はとても重いのでかなり効果があると思います
- 処理省略設定は車両ごとに適用されるが、セーブされないので、セーブデータをロードしたら毎回オフになります。

### 自動ターン経過調整

- 自動ターン経過がオンになっている時、メニューを開いている間は時間が止まるオプションを追加
  - 副作用で、自動ターン経過がオンのとき通常の行動の動作コストがコマンドの入力にかかった時間によって増加するのも抑制される
- おまけで、自動ターン経過で無駄にした行動コストを表示するオプションも追加

### ホードビーコン

- 起動している間、ゾンビを画面端から召喚し続けるアイテムです。
- 通常のホードビーコンはゾンビフェロモンと、ノイズ発生器（ガガザーガガザギャピー）からクラフトできます。
- 通常のホードビーコンによって発生したゾンビは、殺しても死体やアイテムを残しません。
- 生成するモンスターの種類や、生成間隔、アイテムを落とすか否か等をjsonファイルから設定できます。
  - オリジナルのビーコンmodを作ってシェアしましょう。
- 過去のバージョンの人気MOD「襲撃MOD」を少しマネしました。この場をお借りして作者さまにリスペクトをお送りしたいと思います。

### 近接防衛ボット

- 一般的なタレット製作に必要なスキルと材料＋刃＋ハンマー＋テーザー銃で作れる
- スキルが低くても設置時に敵対はしない
- 射程3以内に入った敵に対して威力10～20の、1/2で打撃か斬撃、あるいは1/7で電撃攻撃をする
- 防御力は一般的なタレットと同等で、HPは約3倍の100HP

### クラフト関係

- 世界設定のオプションから、クラフト時の一括製作の上限を変更できます。
  - ゲームの仕様によって**材料の総容量が1000Lを超えると、ゲームがエラーを出して材料が消えます** ので、注意して使ってください
- NPCに手伝ってもらうことによるクラフト時間短縮の効果が、本家ではNPC2人でクラフト時間60%までなのを、NPC8人で20%まで短縮できるようにしました

### アイテムの追加元Mod名の表示

- アイテムが、どのmodによって追加または変更されたのかを、アイテムの詳細説明の下の方に追加しました。
  - （あまりないけど）1つのアイテムが、2つ以上のmodによって追加や変更されている場合、modリストの並びのより下の方の、最後に変更されたものが表示されます。

### アニメーションタイル

- アニメーションのコマごとのタイルを用意して、tile_config.jsonに独自の記述をすることで、タイルをアニメーションさせることができます。
- 書式の例は、以下のようになります。
```
...
    {
      "id": "mon_little_maid",
      "fg": 1,
      "anime_delay": 5,
      "anime_frame_length": 3,
      "rotates": false
    },
    {
      "id": "mon_little_maid_anime_1",
      "fg": 2,
      "rotates": false
    },
    {
      "id": "mon_little_maid_anime_2",
      "fg": 3,
      "rotates": false
    },
...
```
- まず、元々の本家と同様のタイル指定に加えて、以下の2つの項目を追加します。
  - このタイル指定は、同時にアニメーションの0フレーム目として扱われます。
  - "anime_delay": アニメーションの遅さを1以上の整数で指定します。
    - 1に指定した場合は、元々オプションで指定できる、雨などのアニメーションと同じ速さでアニメーションします。
    - 2ならその半分、5なら5分の1の速さになります。
    - 何も指定しない場合は、1として扱われます。
  - "anime_frame_length": アニメーションのコマ数を、2以上の整数で指定します。
    - フレーム番号は0から数えることに気を付けてください。 anime_frame_lengthに「3」を設定したら、必要なフレームは「0」「1」「2」の「3つ」です。
- 次に、アニメーションのフレームのタイル指定として、idの後ろに「_anime_(数字)」を付けたタイル指定を、フレーム数のぶん追加してください。
  - idの後ろにフレーム番号を付ける以外は、本家のタイル指定と同じです。
    
- 例示したタイル指定は、モンスターのものになりますが、アイテムや装備、車両パーツなど、ほとんどのタイルをアニメーションさせる事ができます。

- アニメーションを定義したmod用タイルを本家に読み込ませた場合は、0フレーム目のみのアニメーションしないタイルとして読まれるはずです。

### Hentai mod

- Lua対応版の時代のHentai modの機能を、ヴァリアントに組み込むことで復活させました！
  - 詳しい説明はここには書けません！ 以下のGoogleドライブの中のReadme.mdなどをご覧ください。
  - https://drive.google.com/drive/u/0/folders/1ZzlBOjlFJQ4Z7UgID1gayo4zKyprct_7

### その他の調整

- 強化車載ヒーターを追加、材料や電力などのコストは2倍ですが、冬でも車内なら全裸でも大丈夫なぐらい暖かくなります
- 待機完了時に経過時間が表示される
- アイテム整理画面の4096個制限の表示を車載カーゴにも表示するように
  - 残念ながら、今のところ、逆に車載カーゴがあるマスの地面のアイテムの数を表示しなくなってしまった。ちゃんとフォーカスしてる場所のアイテム数をちゃんと表示したい
- 軍用探照灯がプルトニウム発電機を必要とせず、さらに友好的な軍用探照灯が、プレイヤーをフォーカスしないように
- ラベルタイプのサイドバーに、古い型の[\_.+\*+.\_]みたいな時計と、((|))みたいな月齢表示の項目を追加
- UPS充電ステーションを車に設置してもタイルが変わらないように（あのでっかい電子チップみたいなやつ）
- 車の位置追跡のメニュー項目が、制御装置があるマスでしか出ないように
- デバッグメニューを開くと、ゲームを終了するまで、セーブする前に確認を出すように
- 入力プロンプトが出たときに、自動で日本語入力をオンにしないオプションを追加
- 酸性雨の対策として、シェルターに中量の雨具のドロップを追加しました
- NPCや、アイテムとして回収できるタイプの友好モンスターにぶつかった時に、自動で入れ替わるオプションを追加しました
  - NPCや友好モンスターにぶつかった時のメニューを出したい時は、[e]キーで調べてみてください
  
